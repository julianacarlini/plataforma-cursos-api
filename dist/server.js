import express from "express";
import helmet from "helmet";
import cors from "cors";
import dotenv from "dotenv";
import rateLimit from "express-rate-limit";
import path from "node:path";
import { fileURLToPath } from "node:url";
dotenv.config();
import authRoutes from "./routes/auth.routes.js";
import usersRoutes from "./routes/users.routes.js";
import coursesRoutes from "./routes/courses.routes.js";
import enrollRoutes from "./routes/enrollments.routes.js";
import lessonsRoutes from "./routes/lessons.routes.js";
import materialsRoutes from "./routes/materials.routes.js";
import eventsRoutes from "./routes/events.routes.js";
import evalRoutes from "./routes/evaluations.routes.js";
import { errorHandler } from "./utils/error-handler.js";
export const app = express();
app.use(helmet({ crossOriginOpenerPolicy: { policy: "same-origin-allow-popups" } }));
app.use(cors({ origin: process.env.CORS_ORIGIN?.split(",") || true, credentials: true }));
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use(rateLimit({ windowMs: 15 * 60 * 1000, max: 200 }));
// arquivos enviados (materiais)
const __dirname = path.dirname(fileURLToPath(import.meta.url));
app.use("/uploads", express.static(path.join(__dirname, "..", process.env.UPLOAD_DIR || "uploads")));
app.use("/api/auth", authRoutes);
app.use("/api/users", usersRoutes);
app.use("/api/courses", coursesRoutes);
app.use("/api/enrollments", enrollRoutes);
app.use("/api/lessons", lessonsRoutes);
app.use("/api/materials", materialsRoutes);
app.use("/api/events", eventsRoutes);
app.use("/api/evaluations", evalRoutes);
app.use(errorHandler);
